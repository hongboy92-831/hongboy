<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 課堂查詢工具</title>
    <!-- 使用 CDN 載入 React 與 Tailwind -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 Lucide 圖標庫 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // 2026年 國定假日與補假清單
        const HOLIDAYS_2026 = [
            "2026-01-01",
            "2026-02-14", "2026-02-15", "2026-02-16", "2026-02-17", "2026-02-18", "2026-02-19", "2026-02-20", "2026-02-21", "2026-02-22",
            "2026-02-27", "2026-02-28",
            "2026-04-03", "2026-04-04", "2026-04-05", "2026-04-06",
            "2026-05-01", "2026-06-19", "2026-09-25", "2026-09-28", "2026-10-09", "2026-10-10", "2026-10-26", "2026-12-25"
        ];

        const WEEKDAY_NAMES = ["日", "一", "二", "三", "四", "五", "六"];

        const formatDate = (date) => {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        };

        function App() {
            const [startMonth, setStartMonth] = useState(2);
            const [endMonth, setEndMonth] = useState(4);
            const [totalClasses, setTotalClasses] = useState(18);
            const [selectedDays, setSelectedDays] = useState([3, 5]);
            const [adjustments, setAdjustments] = useState([]);
            const [newDate, setNewDate] = useState('');
            const [newType, setNewType] = useState('exclude');
            const [results, setResults] = useState(null);

            const handleCalculate = () => {
                const dates = [];
                const holidaySet = new Set(HOLIDAYS_2026);
                let current = new Date(2026, startMonth - 1, 1);
                const endLimit = new Date(2026, endMonth, 0);

                while (dates.length < totalClasses && current <= endLimit) {
                    const dateStr = formatDate(current);
                    const dayOfWeek = current.getDay();
                    const manualAdj = adjustments.find(a => a.date === dateStr);
                    
                    if (manualAdj) {
                        if (manualAdj.type === 'include') {
                            dates.push({ date: dateStr, type: 'manual', note: '手動加課' });
                        }
                    } else if (selectedDays.includes(dayOfWeek) && !holidaySet.has(dateStr)) {
                        dates.push({ date: dateStr, type: 'regular', note: '' });
                    }
                    current.setDate(current.getDate() + 1);
                }

                const stats = {};
                dates.forEach(d => {
                    const month = parseInt(d.date.split('-')[1], 10);
                    stats[month] = (stats[month] || 0) + 1;
                });

                setResults({ dates, stats });
            };

            return (
                <div className="min-h-screen p-4 sm:p-8">
                    <div className="max-w-5xl mx-auto">
                        <header className="mb-8 border-b pb-6 flex flex-col md:flex-row justify-between items-center gap-4">
                            <h1 className="text-3xl font-bold text-indigo-700">2026 課堂查詢</h1>
                            <div className="text-xs font-bold text-gray-400 bg-white px-3 py-1 rounded-full border">
                                已同步 2026 年度行政院例假日
                            </div>
                        </header>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                            <div className="lg:col-span-4 space-y-6">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border">
                                    <h3 className="font-bold mb-4 text-gray-600">課程設定</h3>
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-2 gap-2">
                                            <div className="space-y-1">
                                                <label className="text-[10px] text-gray-400 font-bold uppercase">開始月份</label>
                                                <select value={startMonth} onChange={e => setStartMonth(Number(e.target.value))} className="w-full p-2 border rounded-xl text-sm bg-gray-50">
                                                    {Array.from({length:12}, (_,i)=><option key={i+1} value={i+1}>{i+1}月</option>)}
                                                </select>
                                            </div>
                                            <div className="space-y-1">
                                                <label className="text-[10px] text-gray-400 font-bold uppercase">結束月份</label>
                                                <select value={endMonth} onChange={e => setEndMonth(Number(e.target.value))} className="w-full p-2 border rounded-xl text-sm bg-gray-50">
                                                    {Array.from({length:12}, (_,i)=><option key={i+1} value={i+1}>{i+1}月</option>)}
                                                </select>
                                            </div>
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[10px] text-gray-400 font-bold uppercase">總堂數</label>
                                            <input type="number" value={totalClasses} onChange={e => setTotalClasses(Number(e.target.value))} className="w-full p-2 border rounded-xl font-bold text-indigo-600 bg-gray-50" />
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-[10px] text-gray-400 font-bold uppercase block mb-1">上課星期</label>
                                            <div className="flex justify-between gap-1">
                                                {[1,2,3,4,5,6,0].map(d => (
                                                    <button key={d} onClick={()=>setSelectedDays(prev=>prev.includes(d)?prev.filter(x=>x!==d):[...prev, d])}
                                                        className={`w-9 h-9 rounded-lg text-xs font-bold transition-all ${selectedDays.includes(d)?'bg-indigo-600 text-white shadow-md':'bg-gray-100 text-gray-400 hover:bg-gray-200'}`}>
                                                        {WEEKDAY_NAMES[d]}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="bg-white p-6 rounded-2xl shadow-sm border">
                                    <h3 className="font-bold mb-4 text-gray-600">調課功能</h3>
                                    <input type="date" value={newDate} onChange={e=>setNewDate(e.target.value)} className="w-full p-2 border rounded-xl mb-2 text-sm bg-gray-50 outline-none focus:ring-2 ring-indigo-500" />
                                    <div className="flex gap-2">
                                        <select value={newType} onChange={e=>setNewType(e.target.value)} className="flex-1 p-2 border rounded-xl text-sm bg-white">
                                            <option value="exclude">停課排除</option>
                                            <option value="include">加課補課</option>
                                        </select>
                                        <button onClick={()=>{if(newDate){setAdjustments([...adjustments,{date:newDate,type:newType}]);setNewDate('');}}} className="bg-indigo-600 text-white px-4 rounded-xl shadow-md hover:bg-indigo-700 active:scale-95 transition-all font-bold">+</button>
                                    </div>
                                    <div className="mt-4 flex flex-wrap gap-2">
                                        {adjustments.map(a=>(
                                            <div key={a.date} className="text-[10px] bg-gray-50 border px-2 py-1 rounded-full flex items-center gap-1 font-bold">
                                                <span className={a.type==='exclude'?'text-red-500':'text-green-600'}>{a.type==='exclude'?'停':'加'}</span>
                                                <span className="text-gray-500">{a.date}</span>
                                                <span className="cursor-pointer text-gray-300 hover:text-red-400 ml-1 font-black" onClick={()=>setAdjustments(adjustments.filter(x=>x.date!==a.date))}>×</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <button onClick={handleCalculate} className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-indigo-100 hover:bg-indigo-700 active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                                    <lucide-icon name="search" size="18"></lucide-icon> 開始查詢日期
                                </button>
                            </div>

                            <div className="lg:col-span-8 space-y-6">
                                {results ? (
                                    <>
                                        <div className="bg-indigo-900 rounded-3xl p-6 sm:p-8 text-white shadow-xl relative overflow-hidden">
                                            <div className="flex justify-between items-center mb-6 relative z-10">
                                                <h2 className="text-xl font-bold flex items-center gap-2">每月堂數統計</h2>
                                                <span className="text-sm bg-white/10 px-3 py-1 rounded-lg border border-white/20 font-bold">共 {results.dates.length} 堂</span>
                                            </div>
                                            <div className="grid grid-cols-2 sm:grid-cols-4 gap-4 relative z-10">
                                                {Object.entries(results.stats).sort((a,b)=>a[0]-b[0]).map(([m, c]) => (
                                                    <div key={m} className="bg-white/10 backdrop-blur-md rounded-2xl p-4 text-center border border-white/10">
                                                        <p className="text-xs text-indigo-300 mb-1 font-bold">{m} 月</p>
                                                        <p className="text-3xl font-black tracking-tight">{c} <span className="text-xs font-normal opacity-50 ml-0.5">堂</span></p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="bg-white rounded-3xl border shadow-sm overflow-hidden">
                                            <div className="p-5 bg-gray-50 font-bold border-b text-gray-700 flex justify-between items-center">
                                                <span>詳細清單</span>
                                                <span className="text-[10px] text-gray-400 uppercase tracking-widest">Schedule Details</span>
                                            </div>
                                            <div className="max-h-[500px] overflow-y-auto divide-y divide-gray-50">
                                                {results.dates.map((item, idx) => {
                                                    const d = new Date(item.date);
                                                    return (
                                                        <div key={item.date} className="p-4 sm:px-6 flex justify-between items-center hover:bg-indigo-50/30 transition-colors group">
                                                            <div className="flex items-center gap-5">
                                                                <span className="text-sm font-mono font-bold text-gray-200 group-hover:text-indigo-200 transition-colors">{(idx+1).toString().padStart(2,'0')}</span>
                                                                <div>
                                                                    <p className="font-bold text-gray-800">{item.date}</p>
                                                                    <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded ${d.getDay()===0||d.getDay()===6?'bg-red-50 text-red-400':'bg-gray-100 text-gray-400'}`}>
                                                                        週{WEEKDAY_NAMES[d.getDay()]}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            {item.note && (
                                                                <span className="text-[10px] bg-green-50 text-green-600 px-2 py-1 rounded-full font-black border border-green-100">
                                                                    {item.note}
                                                                </span>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    </>
                                ) : (
                                    <div className="h-full min-h-[400px] border-2 border-dashed border-gray-100 rounded-3xl flex flex-col items-center justify-center text-gray-300 bg-white">
                                        <div className="p-6 bg-gray-50 rounded-full mb-4">
                                            <i data-lucide="calendar-search" className="w-12 h-12 opacity-20"></i>
                                        </div>
                                        <p className="font-bold italic">請設定條件後開始查詢日期</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        <footer className="mt-10 mb-8 text-center">
                            <div className="inline-flex items-center gap-2 bg-amber-50 text-amber-700 px-5 py-2.5 rounded-full text-xs font-bold border border-amber-100 shadow-sm">
                                <i data-lucide="alert-circle" className="w-4 h-4"></i>
                                2026年二月排除春節與228補假，週三五上課預計為 5 堂。
                            </div>
                        </footer>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // 初始化圖標
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>
